"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.sanitizeErrorMessage = sanitizeErrorMessage;
exports.filterSpecArgs = filterSpecArgs;

var _constants = require("./constants");

function sanitizeErrorMessage(commandError, savedError) {
  let name, stack, message;

  if (commandError instanceof Error) {
    ({
      name,
      message,
      stack
    } = commandError);
  } else {
    ({
      name
    } = savedError);
    message = commandError;
  }

  const err = new Error(message);
  err.name = name;
  err.stack = savedError.stack;

  if (stack) {
    err.stack = stack + '\n' + err.stack;
  }

  let stackArr = err.stack.split('\n');
  stackArr = stackArr.filter(_constants.STACKTRACE_FILTER_FN);
  err.stack = stackArr.reduce((acc, currentValue) => {
    return acc.includes(currentValue) ? acc : `${acc}\n${currentValue}`;
  }, '').trim();
  return err;
}

function filterSpecArgs(args) {
  return args.filter(arg => typeof arg !== 'function');
}